<ion-header [translucent]="true">
  <ion-toolbar class="bg-white shadow-sm">
    <ion-title class="flex items-center justify-center gap-2">
      <span class="text-lg font-semibold text-blue-600">FASTPASS</span>
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="map-container">
    <div class="map-grid"></div>

    <div
      class="marker"
      *ngFor="let lot of visibleParkingLots"
      [style.left]="lot.mapX + 'px'"
      [style.top]="lot.mapY + 'px'"
      [ngClass]="getMarkerColor(lot.available, lot.capacity)"
      (click)="viewLotDetails(lot)"
    >
      {{ lot.available ?? 0 }}
    </div>
  </div>

  <div
    class="bottom-sheet"
    [class.snapping]="isSnapping"
    [ngStyle]="{
      'height': sheetHeights[sheetLevel]
    }"
  >
    <div
      class="drag-header"
      (mousedown)="startDrag($event)"
      (touchstart)="startDrag($event)"
    >
      <div class="drag-line"></div>
    </div>

    <div
      class="sheet-content"
      [class.lock-scroll]="!canScroll"
      #sheetContent
    >
      <ion-searchbar
        [(ngModel)]="searchQuery"
        placeholder="ค้นหาที่จอดรถ..."
        (ionChange)="onSearch()"
      ></ion-searchbar>

      <div class="filter-row">
        <ion-segment [(ngModel)]="selectedTab" (ionChange)="onTabChange()">
          <ion-segment-button value="normal">
            <ion-label>ทั่วไป</ion-label>
          </ion-segment-button>

          <ion-segment-button value="ev">
            <ion-label>EV</ion-label>
          </ion-segment-button>

          <ion-segment-button value="motorcycle">
            <ion-label>มอไซค์</ion-label>
          </ion-segment-button>
        </ion-segment>
      </div>

      <div class="lot-list">
        <div
          class="lot-card"
          *ngFor="let lot of filteredParkingLots"
          (click)="viewLotDetails(lot)"
        >
          <div class="lot-header">
            <h3>{{ lot.name }}</h3>
            <span class="status" [ngClass]="getStatusColor(lot.status)">{{
              getStatusText(lot.status)
            }}</span>
          </div>
          <p class="text-sm text-gray-600">
            {{ lot.available }} / {{ lot.capacity }} คัน
          </p>
          <p class="text-xs text-gray-400">{{ lot.hours }}</p>
        </div>
      </div>
    </div>
  </div>
</ion-content>