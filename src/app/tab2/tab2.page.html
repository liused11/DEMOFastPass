<ion-header class="ion-no-border">
  <ion-toolbar class="main-header">
    <ion-title>การจองของฉัน</ion-title>
    <ion-buttons slot="end">
      <ion-button>
        <ion-icon name="search-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>

  <!-- Filter Dropdowns Row -->
  <div class="filter-row">
    <!-- Date/Month Filter -->
    <div class="filter-dropdown">
      <ion-icon name="calendar-outline" class="start-icon"></ion-icon>
      <span class="filter-text">{{ selectedMonth }}</span>
      <ion-icon name="chevron-down-outline" class="end-icon"></ion-icon>
    </div>

    <!-- Category Filter -->
    <div class="filter-dropdown">
      <ion-icon name="layers-outline" class="start-icon"></ion-icon>
      <span class="filter-text">รายการทั้งหมด</span>
      <ion-icon name="chevron-down-outline" class="end-icon"></ion-icon>
    </div>
  </div>

  <!-- Status Tabs -->
  <ion-toolbar class="segment-toolbar">
    <ion-segment [(ngModel)]="selectedStatusSegment" (ionChange)="segmentChanged($event)" mode="md"
      class="custom-segment">
      <ion-segment-button value="in_progress">
        <ion-label>กำลังดำเนินการ</ion-label>
      </ion-segment-button>
      <ion-segment-button value="completed">
        <ion-label>เสร็จสิ้น</ion-label>
      </ion-segment-button>
      <ion-segment-button value="cancelled">
        <ion-label>ยกเลิก/ล้มเหลว</ion-label>
      </ion-segment-button>
    </ion-segment>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="main-content">
  <div class="content-wrapper">

    <!-- Daily Bookings Section -->
    <div *ngIf="dailyBookings.length > 0">
      <div class="section-header" *ngIf="dailyBookings.length > 0">
        <h3>รายการล่าสุด</h3>
      </div>

      <div *ngFor="let item of dailyBookings" class="modern-card">
        <div class="card-top">
          <div class="place-info">
            <!-- Status Header with Icon if needed -->
            <div class="status-header" [ngClass]="getStatusClass(item)">
              <ion-icon name="car-sport" *ngIf="item.status === 'confirmed'"></ion-icon>
              {{ getStatusText(item) }}
            </div>

            <div class="location-row">
              <h2 class="place-name">{{ item.locationDetails.split('|')[0] }} | {{ item.locationDetails.split('|')[1] }}
              </h2> <!-- Split logic purely visual based on mock -->
              <div class="slot-number" *ngIf="item.licensePlate === 'A06'">A06</div>
              <!-- Mock specific logic for A06 if needed, or just bind generic -->
              <div class="slot-number"
                *ngIf="item.licensePlate !== 'A06' && item.placeName.includes('(S2)') && item.status == 'confirmed'">B04
              </div>
            </div>

            <div class="sub-details">
              <p class="location-name"><ion-icon name="location-outline"></ion-icon> {{ item.placeName }}</p>
              <div class="right-detail">
                <p class="car-brand"><ion-icon name="car"></ion-icon> {{ item.carBrand || 'TOYOTA YARIS' }}</p>
                <p class="plate">{{ item.licensePlate }}</p>
              </div>
            </div>
            <div class="time-detail">
              <ion-icon name="time-outline"></ion-icon>
              {{ item.bookingTime | date:'EEE d MMM' }} · {{ item.bookingTime | date:'HH:mm' }} - {{ item.endTime |
              date:'HH:mm' }} น.
            </div>
          </div>
        </div>

        <!-- Action / Price Bar -->
        <div class="action-bar" [ngClass]="item.status === 'pending_payment' ? 'white-bg' : 'blue-bg'">
          <div class="price-tag" [class.text-blue]="item.status === 'pending_payment'">
            <ion-icon name="wallet-outline"></ion-icon> ฿{{ item.price }}
          </div>
          <div class="action-button">
            <span *ngIf="item.status === 'confirmed'">ชำระเงินตอนนี้ -></span>
            <span *ngIf="item.status === 'pending_payment'"></span>
          </div>
        </div>
      </div>
    </div>

    <!-- Monthly Bookings Section -->
    <div *ngIf="monthlyBookings.length > 0">
      <div class="section-header">
        <h3>รายการการจองประจำเดือน</h3>
      </div>

      <div *ngFor="let item of monthlyBookings" class="modern-card monthly-card">
        <div class="card-top">
          <div class="status-header text-blue">
            <ion-icon name="car-sport"></ion-icon> ใช้งานอยู่
            <span class="edit-link">แก้ไข -></span>
          </div>

          <div class="location-row">
            <h2 class="place-name">{{ item.locationDetails.split('|')[0] }} | {{ item.locationDetails.split('|')[1] }}
            </h2>
            <div class="slot-number">D15</div>
          </div>

          <div class="sub-details">
            <p class="location-name"><ion-icon name="location-outline"></ion-icon> {{ item.placeName }}</p>
            <div class="right-detail">
              <p class="car-brand"><ion-icon name="car"></ion-icon> {{ item.carBrand }}</p>
              <p class="plate">{{ item.licensePlate }}</p>
            </div>
          </div>

          <div class="time-detail">
            <ion-icon name="calendar-outline"></ion-icon>
            1 ธ.ค. - 31 มี.ค. 69 (ทุกวัน จ. - ศ.) <br>
            <ion-icon name="time-outline"></ion-icon> 08:00 - 18:00 น.
          </div>
        </div>
        <div class="action-bar white-bg">
          <div class="price-tag text-blue">
            <ion-icon name="wallet-outline"></ion-icon> ฿{{ item.price | number:'1.0-0' }}
          </div>
          <div class="action-button text-blue-small">
            ชำระเงินสำเร็จแล้ว
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="dailyBookings.length === 0 && monthlyBookings.length === 0" class="empty-state">
      <div class="empty-icon-bg"><ion-icon name="receipt-outline"></ion-icon></div>
      <h3>ไม่มีรายการ</h3>
      <p>ไม่พบประวัติการจองในสถานะนี้</p>
    </div>

  </div>
</ion-content>